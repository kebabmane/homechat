<%= render 'admin/header' %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-8 pb-24 space-y-8">
  <section class="rounded-xl border border-gray-200 bg-white shadow-sm overflow-hidden">
    <header class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
      <h2 class="text-lg font-semibold text-gray-900">User directory</h2>
      <span class="text-sm text-gray-500"><%= @users.size %> members</span>
    </header>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50 text-xs uppercase text-gray-500">
          <tr>
            <th class="px-5 py-3 text-left">Username</th>
            <th class="px-5 py-3 text-left">Role</th>
            <th class="px-5 py-3 text-left">Messages</th>
            <th class="px-5 py-3 text-left">Channels</th>
            <th class="px-5 py-3 text-left">Created</th>
            <th class="px-5 py-3 text-right">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200 text-sm text-gray-700">
          <% @users.each do |user| %>
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="px-5 py-3 font-medium text-gray-900"><%= user.username %></td>
              <td class="px-5 py-3">
                <span class="status-dot <%= user.admin? ? 'status-dot--ok' : 'status-dot--warn' %> mr-2"></span>
                <span><%= user.admin? ? 'Admin' : 'User' %></span>
              </td>
              <td class="px-5 py-3"><%= user.messages.count %></td>
              <td class="px-5 py-3"><%= user.channels.count %></td>
              <td class="px-5 py-3"><%= user.created_at.strftime('%Y-%m-%d %H:%M') %></td>
              <td class="px-5 py-3">
                <%= form_with url: admin_user_path(user), method: :patch, local: true, class: "flex flex-wrap justify-end gap-2" do |f| %>
                  <select name="user[role]" class="rounded-md border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <option value="user" <%= 'selected' if user.role == 'user' %>>User</option>
                    <option value="admin" <%= 'selected' if user.role == 'admin' %>>Admin</option>
                  </select>
                  <button type="submit" class="inline-flex items-center rounded-md bg-blue-600 px-4 py-2 text-xs font-medium text-white transition hover:bg-blue-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500">Update</button>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </section>
</div>
