<%= render 'admin/header' %>

<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mt-6 pb-14 space-y-8">
  <div class="grid gap-6 md:grid-cols-2 xl:grid-cols-3">
    <div class="rounded-xl border border-blue-100 bg-blue-50/50 p-5 shadow-sm">
      <div class="flex items-start justify-between">
        <div>
          <p class="text-sm font-medium text-blue-700">Active Tokens</p>
          <p class="mt-2 text-3xl font-semibold text-blue-900">
            <%= @active_token_count %>
            <span class="text-base font-normal text-blue-500">/ <%= @token_count %></span>
          </p>
        </div>
        <div class="h-10 w-10 rounded-full bg-blue-600/10 text-blue-700 flex items-center justify-center">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
          </svg>
        </div>
      </div>
      <p class="mt-3 text-xs text-blue-600">Last use: <%= @last_token_use&.strftime('%Y-%m-%d %H:%M') || 'Never' %></p>
    </div>

    <div class="rounded-xl border border-violet-100 bg-violet-50/50 p-5 shadow-sm">
      <div class="flex items-start justify-between">
        <div>
          <p class="text-sm font-medium text-violet-700">Bots Online</p>
          <p class="mt-2 text-3xl font-semibold text-violet-900">
            <%= @bots_active %>
            <span class="text-base font-normal text-violet-500">/ <%= @bots_total %></span>
          </p>
        </div>
        <div class="h-10 w-10 rounded-full bg-violet-600/10 text-violet-700 flex items-center justify-center">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6l4 2" />
          </svg>
        </div>
      </div>
      <p class="mt-3 text-xs text-violet-600">Keep bots updated to avoid automation gaps.</p>
    </div>

    <div class="rounded-xl border border-emerald-100 bg-emerald-50/50 p-5 shadow-sm">
      <div class="flex items-start justify-between">
        <div>
          <p class="text-sm font-medium text-emerald-700">Integration Status</p>
          <div class="mt-3 space-y-2 text-sm text-emerald-800">
            <div class="flex items-center gap-2">
              <span class="status-dot <%= @api_enabled ? 'status-dot--ok' : 'status-dot--warn' %>"></span>
              <span>API <%= @api_enabled ? 'enabled' : 'disabled' %></span>
            </div>
            <div class="flex items-center gap-2">
              <span class="status-dot <%= @ha_enabled ? 'status-dot--ok' : 'status-dot--warn' %>"></span>
              <span>Home Assistant <%= @ha_enabled ? 'linked' : 'offline' %></span>
            </div>
          </div>
        </div>
        <div class="h-10 w-10 rounded-full bg-emerald-600/10 text-emerald-700 flex items-center justify-center">
          <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="1.8" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 13h2l2 6 3-14 3 10 2-6h4" />
          </svg>
        </div>
      </div>
      <p class="mt-3 text-xs text-emerald-600 break-all">
        Webhook base: <%= @webhook_base %>
      </p>
    </div>
  </div>

  <div class="grid gap-6 lg:grid-cols-3">
    <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm lg:col-span-2">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold text-gray-900">System checklist</h2>
        <%= link_to 'View integrations', admin_integrations_path, class: 'text-sm text-blue-600 hover:text-blue-700' %>
      </div>
      <ul class="space-y-3 text-sm text-gray-700">
        <li class="flex items-start gap-3">
          <span class="status-dot <%= @api_enabled ? 'status-dot--ok' : 'status-dot--warn' %> mt-1"></span>
          <div>
            <p class="font-medium">API access <%= @api_enabled ? 'enabled' : 'disabled' %></p>
            <p class="text-xs text-gray-500">Toggle API availability under Server Settings when exposing HomeChat externally.</p>
          </div>
        </li>
        <li class="flex items-start gap-3">
          <span class="status-dot <%= @ha_enabled ? 'status-dot--ok' : 'status-dot--warn' %> mt-1"></span>
          <div>
            <p class="font-medium">Home Assistant connection <%= @ha_enabled ? 'active' : 'pending' %></p>
            <p class="text-xs text-gray-500">Ensure the integration token is valid to keep automations in sync.</p>
          </div>
        </li>
        <% if @admin_credentials_available %>
          <li class="flex items-start gap-3">
            <span class="status-dot status-dot--warn mt-1"></span>
            <div>
              <p class="font-medium">Default admin credentials detected</p>
              <p class="text-xs text-gray-500">Rotate the bootstrap password and delete the credentials file for security.</p>
              <%= link_to 'View credentials file', admin_admin_credentials_path, class: 'mt-2 inline-flex text-sm text-blue-600 hover:text-blue-700' %>
            </div>
          </li>
        <% else %>
          <li class="flex items-start gap-3">
            <span class="status-dot status-dot--ok mt-1"></span>
            <div>
              <p class="font-medium">Admin password rotated</p>
              <p class="text-xs text-gray-500">No default credential file present. Keep storing passwords securely.</p>
            </div>
          </li>
        <% end %>
      </ul>
    </div>

    <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Quick actions</h2>
      <div class="space-y-3 text-sm">
        <%= link_to admin_tokens_path(anchor: 'create-token'), class: 'quick-action-link' do %>
          <span>Generate API token</span>
          <span class="quick-action-icon">→</span>
        <% end %>
        <%= link_to admin_bots_path, class: 'quick-action-link' do %>
          <span>Review automation bots</span>
          <span class="quick-action-icon">→</span>
        <% end %>
        <%= link_to admin_users_path, class: 'quick-action-link' do %>
          <span>Audit user roles</span>
          <span class="quick-action-icon">→</span>
        <% end %>
        <%= link_to edit_admin_settings_path, class: 'quick-action-link' do %>
          <span>Update server settings</span>
          <span class="quick-action-icon">→</span>
        <% end %>
      </div>
    </div>
  </div>

  <div class="rounded-xl border border-gray-200 bg-white p-6 shadow-sm">
    <h2 class="text-lg font-semibold text-gray-900 mb-4">Helpful links</h2>
    <div class="flex flex-wrap gap-3 text-sm text-gray-600">
      <%= link_to 'User directory', admin_users_path, class: 'chip-link' %>
      <%= link_to 'Bots & automations', admin_bots_path, class: 'chip-link' %>
      <%= link_to 'Integrations', admin_integrations_path, class: 'chip-link' %>
      <%= link_to 'Server settings', edit_admin_settings_path, class: 'chip-link' %>
      <%= link_to 'API tokens', admin_tokens_path, class: 'chip-link' %>
    </div>
  </div>
</div>
