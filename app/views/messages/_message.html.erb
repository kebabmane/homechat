<div class="flex items-start gap-3 sm:gap-4">
  <div class="flex-shrink-0">
    <%= avatar_for(message.user) %>
  </div>
  <div class="flex-1 min-w-0">
    <div class="flex flex-wrap items-baseline gap-x-2 gap-y-1 mb-1">
      <span class="font-semibold text-gray-900 truncate"><%= message.user.username %></span>
      <span class="text-xs text-gray-500" title="<%= message.created_at.strftime('%B %d, %Y at %I:%M %p') %>">
        <%= message.created_at.strftime('%I:%M %p') %>
      </span>
    </div>
    <div class="message-body text-gray-800 leading-relaxed break-words"><%= render_message_body(message.content).html_safe %></div>
    <%= render_link_previews(message) %>
    <% if message.files.attached? %>
      <div class="mt-2 space-y-2">
        <% message.files.each do |file| %>
          <% if file.image? %>
            <%= image_tag file, class: "max-h-56 rounded-lg border border-gray-200 cursor-zoom-in", data: { controller: 'lightbox', action: 'click->lightbox#open' } %>
          <% else %>
            <%= link_to file.filename, url_for(file), class: "text-sm text-blue-600 hover:text-blue-700 underline" %>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
